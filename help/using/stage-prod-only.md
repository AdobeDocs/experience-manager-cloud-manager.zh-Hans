---
title: 仅限阶段和仅限生产管道
description: 了解如何使用专用管道将暂存和生产部署拆分。
source-git-commit: c09fbf30270523018a36b128d43cbf10e65daf54
workflow-type: tm+mt
source-wordcount: '842'
ht-degree: 1%

---


# 仅限暂存和仅限生产的管道 {#stage-prod-only}

了解如何使用专用管道将暂存和生产部署拆分。

>[!NOTE]
>
>此功能仅适用于[早期采用者计划。](/help/release-notes/current.md#early-adoption)

## 概述 {#overview}

暂存环境和生产环境紧密结合。 默认情况下，部署到这些环境将链接到单个管道。 这是一个部署到项目中暂存和生产环境的部署管道。 虽然这种耦合通常是合适的，但在某些用例中存在缺点：

* 如果您希望部署到仅暂存环境，则只能通过拒绝 **提升至生产** 在管道中步骤。 但是，执行将被标记为已取消。
* 如果您希望将暂存环境中的最新代码部署到生产环境，则需要重新部署整个管道，包括暂存部署，即使那里未更改任何代码。
* 由于在部署期间无法更新环境，因此，如果您希望在升级到生产环境之前在暂存环境中暂停并测试多天，则无法更新生产环境。 这会产生非依赖性任务，例如更新 [环境变量](/help/getting-started/build-environment.md#environment-variables) 不可能。

仅限暂存和仅限生产管道通过提供专用部署选项为这些用例提供了解决方案。

* **仅限暂存的部署管道** 仅部署到暂存环境，并在完成部署和测试后执行完成。
   * 仅暂存管道的行为与标准耦合全栈生产管道相同，但无需生产部署步骤（批准、计划、部署）。
* **仅生产部署管道** 仅部署到生产环境，并且可选择在暂存环境中成功完成并验证的执行并将其工件部署到生产环境中。
   * 仅生产管道将重用暂存部署中的工件，跳过构建阶段。

当全栈生产管道运行时，不会执行仅阶段管道和仅生产管道，反之亦然。

这些专用管道提供了更大的灵活性，但请注意以下详细操作和建议。

>[!NOTE]
>
>仅生产管道将始终使用仅阶段管道中的工件，而不管在此期间，可能通过标准耦合生产管道在阶段上部署了哪些工件。
>
>* 这可能会导致不必要的代码回滚。
>* Adobe建议在开始使用仅生产管道和仅阶段管道后，停止使用标准耦合生产管道。
>* 如果您仍决定同时运行标准耦合管道和仅暂存/生产管道，请牢记重复使用工件以避免代码回滚。

## 管道创建 {#pipeline-creation}

仅生产管道和仅舞台管道的创建方式与标准耦合类似 [生产管道](/help/using/production-pipelines.md) 和 [非生产管道。](/help/using/non-production-pipelines.md) 有关详细信息，请参阅这些文档。

1. 在 **管道** 窗口，点击或单击 **添加管道**.

   * 选择 **添加非生产管道** 创建仅限暂存的管道。
   * 选择 **添加仅生产管道** 创建仅生产管道。

   ![创建仅生产/暂存管道](/help/assets/configure-pipelines/prod-stage-pipelines.png)

>[!NOTE]
>
>如果相应的管道已存在，则某些选项可能会灰显。
>
>* **添加仅生产管道** 如果仅暂存管道尚不存在，则将不可用。
>* **添加生产管道** 如果标准耦合管道已存在，则将不可用。
>* 每个程序仅允许一个仅生产管道和一个仅阶段管道。

### 仅限阶段的管道 {#stage-only}

1. 一旦您选择 **添加非生产管道** 选项，则 **添加非生产管道** 对话框打开。
1. 要创建仅暂存管道，请在中选择暂存环境 **符合条件的部署环境** 字段输入正确的缩写。 填写其余字段，然后点按或单击 **继续**.

   ![创建仅暂存管道](/help/assets/configure-pipelines/stage-only.png)

1. 在 **暂存测试** 选项卡中，您可以定义应在暂存环境中执行的测试。 点击或单击 **保存** 以保存新管道。

   ![仅暂存管道的测试参数](/help/assets/configure-pipelines/stage-only-test.png)

### 仅生产管道 {#prod-only}

1. 一旦您选择 **添加仅生产管道** 选项，则 **添加仅生产管道** 对话框打开。
1. 提供 **管道名称**. 对话框的其余选项和功能与标准耦合管道创建对话框中的选项和功能相同。 点击或单击 **保存** 以保存管道。

   ![创建仅限生产的管道](/help/assets/configure-pipelines/prod-only-pipeline.png)

## 运行仅生产管道和仅舞台管道 {#running}

仅生产管道和仅舞台管道的运行方式与相同 [所有其他管道均已运行。](/help/using/managing-pipelines.md#running-pipelines) 有关详细信息，请参阅此文档。

此外，可以直接从仅阶段管道的执行详细信息触发仅生产管道运行。

### 仅限阶段的管道 {#stage-only-run}

纯级管道的运行方式与标准耦合管道几乎相同。 但在运行结束时，测试步骤完成后， **提升内部版本** 按钮允许您启动仅用于生产环境的管道执行，该执行使用此执行在暂存环境中部署的工件并将其部署到生产环境中。

![仅暂存管道运行](/help/assets/configure-pipelines/stage-only-pipeline-run.png)

此 **提升内部版本** 仅当您处于最近成功的仅阶段管道执行时，才会显示按钮。 点按或单击后，它将要求您确认仅生产管道的运行，或创建仅生产管道（如果尚不存在）。

### 仅生产管道 {#prod-only-run}

对于仅用于生产环境的管道，必须标识要部署到生产环境的源工件。 欲知这些详情，请参见 **工件准备** 步骤。 您可以导航到这些执行，以了解更多详细信息和日志。

![工件详细信息](/help/assets/configure-pipelines/prod-only-pipeline-run.png)
