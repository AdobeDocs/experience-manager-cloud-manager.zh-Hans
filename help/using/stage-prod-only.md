---
title: 仅暂存和仅生产管道
description: 了解如何使用专用管道拆分暂存和生产部署。
exl-id: b7dd0021-d346-464a-a49e-72864b01cce3
source-git-commit: 77eb1c824ba766e43dfd8e2b0f6f6edc71f043e5
workflow-type: tm+mt
source-wordcount: '943'
ht-degree: 31%

---

# 仅限暂存和仅限生产的管道 {#stage-prod-only}

了解如何使用专用管道拆分暂存和生产部署。

>[!NOTE]
>
>此功能仅适用于[早期采用者计划](/help/release-notes/current.md#early-adoption)。

## 概述 {#overview}

暂存环境和生产环境紧密耦合。默认情况下，对它们的部署链接到单一管道。也就是说，部署管道将部署到该项目中的暂存环境和生产环境。 虽然这种耦合通常是合适的，但在某些用例中存在缺点：

* 如果要部署到仅暂存环境，请拒绝管道中的&#x200B;**Promote to Prod**&#x200B;步骤。 但是，执行会标记为已取消。
* 如果要在暂存环境中将最新代码部署到生产环境，则需要重新部署整个管道，包括暂存部署，即使那里未更改任何代码。
* 部署期间无法更新环境。 如果在升级到生产环境之前，在暂存环境中暂停测试数天，则生产环境将保持锁定状态，并且无法更新。 此方案使非依赖任务无法更新[环境变量](/help/getting-started/build-environment.md#environment-variables)。

仅暂存和仅生产管道通过提供专用的部署选项为这些用例提供解决方案。

* **仅限暂存的部署管道：**&#x200B;仅部署到暂存环境，部署及测试完成后执行完成。 仅暂存管道的行为与标准耦合全栈生产管道相同，但没有生产部署步骤（审批、计划、部署）。
* **仅生产部署管道：**&#x200B;通过选择成功的阶段执行仅部署到生产环境。 然后将其工件部署到生产环境。 仅生产管道会重用阶段部署工件，而绕过构建阶段。

全栈生产管道正在进行时，仅阶段管道和仅生产管道不会执行，反之亦然。 如果仅阶段生产管道和全栈生产管道都配置了 **On Git Changes** 触发器，并且指向同一个分支和存储库，则只有仅阶段生产管道会自动启动。仅生产管道不会启动&#x200B;**`On Git Changes`**，因为它们未直接链接到存储库。

仅生产管道是手动触发的，因为它们未直接链接到&#x200B;**Git更改**&#x200B;的存储库。

这些专用管道提供了更大的灵活性，但您应注意到以下有关操作和建议的详细信息。

>[!NOTE]
>
>仅生产管道始终使用仅阶段管道中的工件。 即使标准耦合生产管道在此期间将其他内容部署到暂存环境，此过程仍然有效。
>
>* 此类情况可能会导致不想要代码回滚。
>* Adobe 建议在您开始使用仅生产和仅暂存管道后，就停止使用标准耦合生产管道。
>* 如果您仍然决定运行标准耦合管道和仅暂存/仅生产管道，请记住重用工件以避免代码回滚。

## 管道创建 {#pipeline-creation}

仅生产管道和仅暂存管道的创建方式与标准耦合[生产管道](/help/using/production-pipelines.md)和[非生产管道](/help/using/non-production-pipelines.md)的创建方式类似。 有关详细信息，请参阅这些文档。

1. 在&#x200B;**管道**&#x200B;窗口中，单击&#x200B;**添加管道**。

   * 选择&#x200B;**添加非生产管道**&#x200B;来创建仅暂存管道。
   * 选择&#x200B;**添加仅生产管道**&#x200B;来创建仅生产管道。

   ![创建仅生产/仅暂存管道](/help/assets/configure-pipelines/prod-stage-pipelines.png)

>[!NOTE]
>
>如果相应的管道已经存在，则某些选项可能会变灰。
>
>* 如果仅暂存管道尚不存在，**添加仅生产管道**&#x200B;不可用。
>* 如果标准耦合管道已存在，则&#x200B;**添加生产管道**&#x200B;不可用。
>* 每个程序只允许一个仅生产和一个仅暂存管道。

### 仅限阶段的管道 {#stage-only}

1. 选择&#x200B;**添加非生产管道**&#x200B;选项后，**添加非生产管道**&#x200B;对话框将打开。
1. 要创建仅暂存管道，请在管道的&#x200B;**符合资格的部署环境**&#x200B;字段中选择暂存环境。完成其余字段，然后单击&#x200B;**继续**。

   ![创建仅暂存管道](/help/assets/configure-pipelines/stage-only.png)

1. 在&#x200B;**暂存测试**&#x200B;选项卡上，您可以定义应在暂存环境中执行的测试。 单击&#x200B;**保存**&#x200B;以保存您的新管道。

   ![仅暂存管道的测试参数](/help/assets/configure-pipelines/stage-only-test.png)

### 仅生产管道 {#prod-only}

1. 选择&#x200B;**仅添加生产管道**&#x200B;选项后，**仅添加生产管道**&#x200B;对话框将打开。
1. 提供&#x200B;**管道名称**。该对话框的其余选项和功能与在标准耦合管线创建对话框中找到的选项的作用相同。 单击&#x200B;**保存**&#x200B;以保存管道。

   ![创建仅生产管道](/help/assets/configure-pipelines/prod-only-pipeline.png)

## 运行仅生产管道和仅舞台管道 {#running}

仅生产管道和仅舞台管道的运行方式与[所有其他管道的运行方式大致相同。](/help/using/managing-pipelines.md#running-pipelines)有关详细信息，请参阅该文档。 但是，这些管道有两个新特征。

* 仅暂存管道和仅生产管道提供了新的[紧急模式](#emergency-mode)以允许跳过测试。
* 仅生产管道运行可以直接从[仅暂存管道的执行详细信息触发。](#stage-only-run)

### 紧急模式 {#emergency-mode}

无论何时启动仅生产管道和暂存联机管道，都会提示您确认启动以及启动方式。

* **正常模式**&#x200B;是标准运行，包括暂存测试步骤。
* **紧急模式**&#x200B;跳过暂存测试步骤。

![紧急模式](/help/assets/configure-pipelines/emergency-mode.png)

### 仅限阶段的管道 {#stage-only-run}

仅暂存管道的运行方式几乎与标准耦合管道相同。但是，在运行结束时，在测试步骤之后，将显示&#x200B;**提升内部版本**&#x200B;按钮。 通过此按钮，您可以使用运行中部署在暂存上的工件启动仅用于生产环境的管道执行，并将它们部署到生产环境。

![仅暂存管道运行](/help/assets/configure-pipelines/stage-only-pipeline-run.png)

单击&#x200B;**提升生成**&#x200B;将提示您确认相关仅阶段管道已正常或在[紧急模式下运行。](#emergency-mode)

如果仅生产管道不存在，系统将提示您创建一个管道。

### 仅生产管道 {#prod-only-run}

对于仅用于生产环境的管道，必须标识要部署到生产环境的源工件。 这些详细信息可以在&#x200B;**工件准备**&#x200B;步骤找到。您可以导航到这些执行来获取更多详细信息和日志。

![工件详细信息](/help/assets/configure-pipelines/prod-only-pipeline-run.png)
